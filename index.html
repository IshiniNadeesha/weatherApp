<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real-Time Weather Map</title>
  <!-- Include Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Include Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Define styles for the map container -->
  <style>
    #map { 
      height: 500px; 
      width: 800px;
      border-radius: 10px;
      margin: auto; /* Center horizontally */
    }
  </style>
  <nav class="navbar" style="background-color: #9dd3db;">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">Real-Time Weather Map</span>
    </div>
  </nav>
</head>
<body>

  <!-- Create a div element to hold the map -->
  <div id="map"></div>

  <!-- Include Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Initialize the map
    var map = L.map('map').setView([7.8731, 80.7718], 7); // Set initial view to world map

    // Add a tile layer for the base map
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Function to fetch weather data for all cities
    function fetchWeatherData() {
      fetch('/weather')
        .then(response => response.json())
        .then(weatherData => {
          weatherData.forEach(data => {
            // Extract weather information
            var temperature = data.temperature;
            var humidity = data.humidity;
            var pressure = data.air_pressure;
            var cityName = data.district;
            var latitude = data.latitude;
            var longitude = data.longitude;

            // Choose marker icon based on temperature
            var markerIconUrl = temperature >= 28 ? './sun.png' : './cloud.png';

            // Create a custom marker icon
            var markerIcon = L.icon({
              iconUrl: markerIconUrl,
              iconSize: [40, 40],
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              tooltipAnchor: [16, -28]
            });

            // Create a marker for the city with weather information as popup content
            var marker = L.marker([latitude, longitude], { icon: markerIcon }).addTo(map)
              .bindPopup(`
                <b>${cityName}</b><br>
                <b>Temperature:</b> ${temperature}°C<br>
                <b>Humidity:</b> ${humidity}%<br>
                <b>Air Pressure:</b> ${pressure} hPa
              `);
          });
        })
        .catch(error => console.error('Error fetching weather data:', error));
    }

    // Initially fetch weather data and update every 5 minutes (300000 milliseconds)
    fetchWeatherData();
    setInterval(fetchWeatherData, 300000); // Update every 5 minutes
  </script>
</body>
</html>
